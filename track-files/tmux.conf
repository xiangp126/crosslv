# TMUX 3.3 CONFIGURATION
# Optimized for macOS (iTerm2) and Vim-style workflows

# """"""""""""""""""""""""""""""
# " BASIC CONFIG
# """"""""""""""""""""""""""""""

# Unbinds the default prefix key (C-b)
unbind C-b
# Sets the prefix key to C-x
set -g prefix C-x
# Binds C-x to send the prefix key
bind C-x send-prefix

set -g default-terminal "tmux-256color"
set -as terminal-overrides ',*:Tc'

# Sets the history limit to 80000 lines
set -g history-limit 80000
# Sets the base index for windows and panes to 1
set -g base-index 1
set -g pane-base-index 1
# Automatically renumbers window numbers on closing a pane
set -g renumber-windows on

# Performance and response settings
set -g display-time 3000
set -s escape-time 0
set -g repeat-time 0

# Enables mouse support
set -g mouse on
# Sets the default shell
set-option -g default-shell $SHELL
# Disables renaming of windows and panes
set-option -g allow-rename off

# """"""""""""""""""""""""""""""
# " COPY MODE & CLIPBOARD (OSC 52)
# """"""""""""""""""""""""""""""

# Enables automatic copying to system clipboard via OSC 52
# No xclip/xsel/pbcopy needed - works over SSH!
set -g set-clipboard on
# Sets the mode keys for windows to vi mode
set-window-option -g mode-keys vi

# Bind 'v' to begin selection (like in Vim)
bind-key -T copy-mode-vi v send-keys -X begin-selection

# Bind 'y' to copy (OSC 52 handles system clipboard automatically)
bind-key -T copy-mode-vi y send-keys -X copy-selection-and-cancel

# Mouse drag copies to clipboard automatically via OSC 52
bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-selection-and-cancel
bind-key -T copy-mode MouseDragEnd1Pane send-keys -X copy-selection-and-cancel

# Bind prefix + p to paste the buffer
bind-key -T prefix p paste-buffer

# """"""""""""""""""""""""""""""
# " SEARCH & NAVIGATION
# """"""""""""""""""""""""""""""

# '/' starts a upwards search in the buffer
bind-key -T copy-mode-vi / copy-mode \; command-prompt -p "(Search Up)" "send -X search-backward \"%%%\""
# '?' starts a downwards search in the buffer
bind-key -T copy-mode-vi ? copy-mode \; command-prompt -p "(Search Down)" "send -X search-forward \"%%%\""
# Repeat searches
bind-key -T copy-mode-vi n send -X search-reverse
bind-key -T copy-mode-vi N send -X search-again

# """"""""""""""""""""""""""""""
# " KEY BINDINGS
# """"""""""""""""""""""""""""""

# Reload config file
bind r source-file ~/.tmux.conf \; display "source ~/.tmux.conf done!"

# Attach a new pane in the current path
bind C attach-session -c "#{pane_current_path}" \; display "attach-session done!"

# Pane management
unbind z
bind-key -T prefix x resize-pane -Z
set -g window-size largest
setw -g aggressive-resize on

# Confirm before killing a pane
bind-key -T prefix X confirm-before -p "kill-pane #P? (y/n)" kill-pane

# Session and window jumping
bind-key -T prefix l switch-client -l
bind-key -T prefix 0 last-window

# Alt/Meta + Number keys for window switching
unbind M-0
unbind M-1
unbind M-2
unbind M-3
unbind M-4
unbind M-5
bind -n M-0 select-window -t 10
bind -n M-1 select-window -t 11
bind -n M-2 select-window -t 12
bind -n M-3 select-window -t 13
bind -n M-4 select-window -t 14
bind -n M-5 select-window -t 15

# Window splitting
unbind %
unbind |
bind | split-window -h -c "#{pane_current_path}"
unbind '"'
bind - split-window -v -b -c "#{pane_current_path}"

# """"""""""""""""""""""""""""""
# " STATUS BAR & UI
# """"""""""""""""""""""""""""""

set -g status-interval 5
set -g status-position bottom
set -g status-bg '#333333'
set -g status-fg '#c49c9c'

set -g status-left-length 15
set -g status-left "#[fg=colour0,bg=colour244] #S #[fg=colour242,bg=colour234,nobold,nounderscore,noitalics] "

set -g status-right-length 50
set -g status-right "#[fg=colour0,bg=colour245] %m-%d %H:%M "

# Style settings
set -g window-style 'fg=default,bg=default'
set -g window-active-style 'fg=default,bg=default'
set -g mode-style bg=red,fg=green,blink
set -g pane-active-border-style bg=default,fg=colour24
set -g message-style fg="colour242",bg=colour0
set -g mode-style fg='#9f9f9f',bg='#333333'

setw -g window-status-separator ''
setw -g window-status-format "#[fg=colour246,bg=colour234] #I #[fg=colour247,bg=colour234]#W #F"
setw -g window-status-current-format "#[fg=colour30,bg=colour0,nobold,nounderscore,noitalics] #I #[fg=colour30,bg=colour0]#W#[fg=colour30,bg=colour0,nobold,nounderscore,noitalics] #F"

# """"""""""""""""""""""""""""""
# " TMUX PLUGIN MANAGER (TPM)
# """"""""""""""""""""""""""""""

set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-resurrect'

# CONFIG FOR TMUX-RESURRECT
set -g @resurrect-save 'S'
set -g @resurrect-restore 'R'
set -g @resurrect-save-bash-history 'on'
set -g @resurrect-capture-pane-contents 'on'
set -g @resurrect-strategy-vim 'session'

# Initialize TPM (Keep this at the very bottom)
run-shell ~/.tmux/plugins/tpm/tpm
